# Face Sign Admin Dashboard - Complete Development Specification

## Context from Technical Discussion

This document captures the complete requirements from technical discussions for building the Face Sign Admin Dashboard.

---

## Key Architecture Understanding

### Hierarchy of Systems

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         UAE KYC PLATFORM                                │
│                    (Parent Platform - Existing)                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    KYC DASHBOARD (Existing)                      │   │
│  │                                                                  │   │
│  │  • KYC Journeys (Onboarding, ReKYC, Authorise, 1:Many)          │   │
│  │  • Organization Management                                       │   │
│  │  • User Management                                               │   │
│  │  • API Keys                                                      │   │
│  │  • Billing & Credits                                             │   │
│  │  • Analytics                                                     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │              FACE SIGN DASHBOARD (To Be Built)                   │   │
│  │                                                                  │   │
│  │  • Face Sign Sessions (Contracts)                                │   │
│  │  • Abstracts KYC journey details                                 │   │
│  │  • Shows signing-specific data points                            │   │
│  │  • Separate ownership/branding possible                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Session vs Journey Relationship

```
FACE SIGN SESSION (Parent Workflow)
        │
        ├── Session Token generated by Face Sign
        │
        ├── User previews document
        │
        ├── User confirms preview
        │
        └── KYC JOURNEY (Child Workflow) ◄── Journey token created here
                │                              (just before face verification)
                ├── Face liveness check
                │
                └── Returns to Face Sign session
                        │
                        ├── User positions signature
                        │
                        └── Session COMPLETE
```

**Key Point**: Face Sign session is the "parent" workflow that USES the KYC journey workflow internally. The Face Sign dashboard should ABSTRACT the KYC details and focus on contract/signing data points.

---

## What Already Exists (Reference)

### Existing KYC Dashboard
- **Console URL**: `https://dev.hfn.uaekyc.ae/console` (ICP/Super Admin)
- **Client Dashboard URL**: `https://dev.hfn.uaekyc.ae/dash` (Org User)
- **Revamp Dashboard**: `https://dashboard-revamp-ten.vercel.app/` (Karthik's new design)

### Existing Face Sign Demo
- **URL**: `https://dev.hfn.fsd.uaekyc.ae`
- Uses API/Transaction key from dashboard

### Problems with Existing Dashboard
- POC-era code, only touched when new features added
- UX is terrible - everything horizontal, not intuitive
- Hard to find onboarding flow
- Not suitable for Face Sign's separate branding needs

---

## Dashboard Requirements

### Two Personas

#### 1. ICP Console (Super Admin)
- URL prefix: `/console`
- Can see ALL organizations
- Can see all signing journeys across orgs
- Can onboard new organizations
- Has access to aggregate analytics
- Can create org users, manage any org

#### 2. Client Dashboard (Org User)
- URL prefix: `/dash`
- **Restricted view** - only sees their organization's data
- Only sees modules enabled for their org
- Cannot create other org users (only org root user can)
- Role-based access within org

### Dashboard Toggle/Switcher
- Same domain possible
- Login determines which features are enabled
- Toggle to switch between "UAE KYC" ↔ "Face Sign" dashboard
- If Face Sign is enabled for user, they can toggle to Face Sign view

---

## Module Specifications

### 1. Contracts (Sessions) - MAIN MODULE

This is Face Sign specific. Shows signing sessions, NOT KYC journeys.

```typescript
interface Contract {
  id: string;                     // UUID
  sessionId: string;              // Display ID "FS-2026-XXXXX"
  status: ContractStatus;

  // Document Info
  documentName: string;
  documentHash: string;           // sha256:...
  pageCount: number;
  fileSizeKb: number;

  // Signer Info (from KYC, abstracted)
  signerName: string;
  signerIdNumber: string;
  signerIdType: 'EMIRATES_ID' | 'PASSPORT' | 'GCC_ID';

  // Internal KYC reference (hidden from UI, used internally)
  kycJourneyId: string | null;

  // Timestamps
  createdAt: Date;
  expiresAt: Date;
  completedAt: Date | null;

  // For analytics: which step user dropped off
  lastStep: SessionStep;

  // Termination reason if applicable
  terminationReason?: string;

  // Signature positions
  signaturePositions: SignaturePosition[];

  // Signed document (if completed)
  signedDocument?: SignedDocument;

  // Organization
  orgId: string;
  orgName: string;
}

type ContractStatus = 'CREATED' | 'SIGNED' | 'REJECTED' | 'ABANDONED' | 'EXPIRED';

type SessionStep =
  | 'INITIALIZED'
  | 'DOCUMENT_LOADED'
  | 'PREVIEW_CONFIRMED'
  | 'KYC_STARTED'
  | 'KYC_COMPLETED'
  | 'POSITIONING'
  | 'COMPLETED';
```

#### Contracts List View
- Table with: Session ID, Document, Signer, Status, Created, Last Step
- Filters: Status, Date range, Search
- Show where users dropped off (which step)
- Pagination, sorting

#### Contract Detail View
- Full session info
- Document preview (original)
- Signed document download (if completed)
- Timeline of events
- Signature positions

### 2. API Keys (Transaction Keys)

API keys authenticate SDK clients and determine which modules are enabled.

```typescript
interface ApiKey {
  id: string;
  name: string;
  keyPrefix: string;              // First 8 chars for display
  fullKey?: string;               // Only shown once on creation
  environment: 'LIVE' | 'TEST';
  status: 'ACTIVE' | 'REVOKED';

  // Module enablement (for future)
  enabledModules: string[];       // ['FACE_SIGN'] for now

  createdAt: Date;
  lastUsedAt: Date | null;
  createdBy: string;
}
```

**Current State**: Only Face Sign module exists, so no complex module selection needed yet. But design for future extensibility.

#### API Keys Page
- List of keys with masked display
- Create new key (shown only once!)
- Revoke key
- Environment filter (Live/Test)

### 3. User Management

```typescript
interface User {
  id: string;
  email: string;
  name: string;
  role: UserRole;
  status: 'ACTIVE' | 'INVITED' | 'DISABLED';
  createdAt: Date;
  lastLoginAt: Date | null;
}

type UserRole = 'ROOT' | 'ADMIN' | 'USER';
```

#### Permission Model (Simpler than AWS IAM)
- **NOT policy-based** - it's config-based at org level
- Org-level enable/disable determines what users can see
- Root user can create other org users
- Super admin (ICP) can create any user
- Regular org user CANNOT create other users

#### User Management Page
- List users in org
- Invite new user (if permitted)
- Edit role
- Disable/Enable user

### 4. Analytics

Basic analytics focused on contract completion.

```typescript
interface AnalyticsData {
  // Totals
  totalContracts: number;
  signedContracts: number;
  rejectedContracts: number;
  abandonedContracts: number;
  expiredContracts: number;

  // Rates
  completionRate: number;         // signed / total

  // Drop-off analysis (KEY METRIC)
  dropOffByStep: {
    step: SessionStep;
    count: number;
    percentage: number;
  }[];

  // Time series
  dailyStats: {
    date: string;
    created: number;
    signed: number;
    rejected: number;
  }[];

  // Distribution by status
  statusDistribution: {
    status: ContractStatus;
    count: number;
  }[];
}
```

#### Analytics Page
- Stat cards: Total, Signed, Rejected, Abandoned, Expired
- Drop-off funnel: Where users are abandoning
- Line chart: Contracts over time
- Pie chart: Status distribution
- Date range filter

### 5. Billing (Prepaid Credits Model)

**IMPORTANT**: Billing is PREPAID only. Clients top up credits, then consume them. NO currency is displayed on dashboard.

```typescript
interface BillingData {
  // Credits balance
  credits: {
    available: number;            // Current available credits
    used: number;                 // Total credits consumed
    lowBalanceThreshold: number;  // Warn when below this
  };

  // Module pricing (in credits, not currency)
  pricing: {
    faceSignPerContract: number;  // e.g., 1 credit per signed contract
  };

  // Current period usage
  currentPeriod: {
    start: Date;
    end: Date;
    contractsSigned: number;
    creditsConsumed: number;
  };

  // Top-up history (credits added by ICP/sales)
  topUpHistory: TopUpTransaction[];

  // Usage history (credits consumed)
  usageHistory: UsageTransaction[];
}

interface TopUpTransaction {
  id: string;
  credits: number;
  date: Date;
  addedBy: string;                // ICP user who added credits
  reference?: string;
}

interface UsageTransaction {
  id: string;
  sessionId: string;
  creditsUsed: number;
  date: Date;
}
```

#### Billing Page
- **Credits Balance Card**: Available / Used (with visual progress bar)
- **Low Balance Warning**: Show alert if credits below threshold
- **Pricing Info**: X credits per signed contract (NO currency)
- **This Period Usage**: Contracts signed, credits consumed
- **Top-up History Table**: Date, Credits, Added By, Reference
- **Usage History Table**: Date, Session ID, Credits Used
- Note: Clients cannot top-up themselves, handled by ICP/sales

### 6. Settings

Organization settings.

```typescript
interface OrgSettings {
  // Basic info
  orgName: string;
  orgLogo?: string;

  // Face Sign config
  faceSignConfig: {
    sessionTtlHours: number;
    maxFileSizeMb: number;
    allowedIdTypes: ('EMIRATES_ID' | 'PASSPORT' | 'GCC_ID')[];
  };

  // Webhooks
  webhookUrl?: string;

  // Notifications
  emailNotifications: boolean;
}
```

---

## Organization Onboarding Flow (ICP Console Only)

When onboarding a new client organization, use a TREE structure (not horizontal):

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    ONBOARDING FLOW (Tree Structure)                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Step 1: Basic Details                                                  │
│  └── Organization name, type (Government/Private), contact info         │
│                                                                         │
│  Step 2: Root User                                                      │
│  └── Create root user (actual email), password (can update later)       │
│                                                                         │
│  Step 3: Module Enable/Disable                                          │
│  └── Enable modules for this org                                        │
│      ├── KYC Service ✓                                                  │
│      ├── Authentication Service                                         │
│      ├── Validation Service                                             │
│      └── Face Sign Service ✓  ◄── Our focus                            │
│                                                                         │
│  Step 4: Configure Selected Modules                                     │
│  └── Face Sign Configuration                                            │
│      ├── Session TTL                                                    │
│      ├── Max file size                                                  │
│      └── Allowed ID types                                               │
│                                                                         │
│  Step 5: Pricing Setup                                                  │
│  └── Set credits per module transaction                                 │
│      └── Face Sign: X credits per signed contract                       │
│                                                                         │
│  Step 6: Additional Features (Optional)                                 │
│  └── Feature flags                                                      │
│      └── e.g., Allow reject option in SDK                               │
│                                                                         │
│  Step 7: Review & Activate                                              │
│  └── Summary → Create Organization                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**Key UX Improvement**: Current dashboard shows everything horizontal (all at once). New design should be tree-like (step by step, branching based on selections).

---

## Technical Implementation Notes

### Data Sources

Schemas are in the Face Sign codebase:

```
face-sign/
├── docker/
│   └── migrations/
│       └── postgres/
│           └── *.sql           ◄── Face Sign schemas (sessions, events, etc.)
│
└── (External reference)
    └── serve-backend/          ◄── Organization schemas (if needed)
```

### What to Build (Immediate)

1. **STUB EVERYTHING** - No backend integration
2. **CRUD operations with stub values**
3. **Good UI (Black & White theme)**
4. **Good UX (tree structure for onboarding, clear navigation)**
5. **Admin dashboard with tables, dropdowns**
6. **Two views: Console (Super Admin) and Dash (Client)**

### Schema References

From Face Sign migrations:

```sql
-- sessions table (main data)
CREATE TABLE sessions (
  id UUID PRIMARY KEY,
  org_id UUID NOT NULL,
  status session_status,
  document_hash VARCHAR(71),
  document_source JSONB,
  page_count INT,
  signer_full_name VARCHAR(255),
  user_id_number VARCHAR(50),
  kyc_journey_id UUID,
  signature_positions JSONB,
  template_minio_path VARCHAR(512),
  template_hash VARCHAR(71),
  expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ
);

-- sdk_events table (for timeline/analytics)
CREATE TABLE sdk_events (
  id UUID PRIMARY KEY,
  session_id UUID REFERENCES sessions(id),
  event_type event_type,
  payload JSONB,
  created_at TIMESTAMPTZ
);
```

---

## File Structure

```
src/
├── main.tsx
├── App.tsx
├── index.css                    # Tailwind + Black/White theme
├── lib/
│   └── utils.ts
├── types/
│   ├── contract.ts
│   ├── user.ts
│   ├── organization.ts
│   ├── api-key.ts
│   ├── billing.ts
│   └── analytics.ts
├── data/                        # STUB DATA
│   ├── contracts.ts
│   ├── users.ts
│   ├── organizations.ts
│   ├── api-keys.ts
│   ├── analytics.ts
│   └── billing.ts
├── hooks/
│   ├── useContracts.ts
│   ├── useUsers.ts
│   ├── useOrganizations.ts
│   ├── useApiKeys.ts
│   ├── useAnalytics.ts
│   └── useBilling.ts
├── components/
│   ├── ui/                      # shadcn/ui components
│   ├── layout/
│   │   ├── Sidebar.tsx
│   │   ├── Header.tsx
│   │   ├── DashboardSwitcher.tsx  # UAE KYC ↔ Face Sign toggle
│   │   └── Layout.tsx
│   ├── contracts/
│   │   ├── ContractsTable.tsx
│   │   ├── ContractDetail.tsx
│   │   ├── ContractFilters.tsx
│   │   ├── ContractTimeline.tsx
│   │   ├── DocumentPreview.tsx
│   │   ├── SignedDocumentCard.tsx
│   │   ├── StatusBadge.tsx
│   │   └── DropOffFunnel.tsx     # Analytics: where users drop off
│   ├── organizations/
│   │   ├── OrganizationsTable.tsx
│   │   ├── OrganizationDetail.tsx
│   │   └── OnboardingWizard/     # Tree-structured wizard
│   │       ├── BasicDetails.tsx
│   │       ├── RootUser.tsx
│   │       ├── ModuleSelection.tsx
│   │       ├── ModuleConfig.tsx
│   │       ├── PricingSetup.tsx
│   │       ├── AdditionalFeatures.tsx
│   │       └── ReviewActivate.tsx
│   ├── users/
│   │   ├── UsersTable.tsx
│   │   ├── InviteUserModal.tsx
│   │   └── EditUserModal.tsx
│   ├── api-keys/
│   │   ├── ApiKeysTable.tsx
│   │   ├── CreateKeyModal.tsx
│   │   └── KeyRevealModal.tsx    # Shows key once
│   ├── analytics/
│   │   ├── StatsCards.tsx
│   │   ├── DropOffChart.tsx      # Funnel visualization
│   │   ├── ContractsChart.tsx
│   │   └── StatusDistribution.tsx
│   ├── billing/
│   │   ├── BalanceCard.tsx
│   │   ├── PricingCard.tsx
│   │   ├── UsageCard.tsx
│   │   └── TransactionHistory.tsx
│   └── settings/
│       ├── OrgSettings.tsx
│       └── FaceSignConfig.tsx
├── pages/
│   ├── console/                  # ICP/Super Admin
│   │   ├── Dashboard.tsx
│   │   ├── Contracts.tsx
│   │   ├── ContractDetail.tsx
│   │   ├── Organizations.tsx
│   │   ├── OrganizationDetail.tsx
│   │   ├── OnboardOrganization.tsx
│   │   └── Analytics.tsx
│   └── dash/                     # Client Dashboard
│       ├── Dashboard.tsx
│       ├── Contracts.tsx
│       ├── ContractDetail.tsx
│       ├── ApiKeys.tsx
│       ├── Users.tsx
│       ├── Analytics.tsx
│       ├── Billing.tsx
│       └── Settings.tsx
├── routes.tsx
└── auth/                         # Stub auth
    └── AuthContext.tsx           # Fake logged-in user
```

---

## Routes

```typescript
// Auth (stub)
/login                          → Stub login (select user type)

// ICP Console (Super Admin)
/console                        → Console Dashboard
/console/contracts              → All Contracts (all orgs)
/console/contracts/:id          → Contract Detail
/console/organizations          → Organizations List
/console/organizations/new      → Onboard Organization Wizard
/console/organizations/:id      → Organization Detail
/console/analytics              → Aggregate Analytics

// Client Dashboard (Org User)
/dash                           → Dashboard (org overview)
/dash/contracts                 → Contracts List (this org only)
/dash/contracts/:id             → Contract Detail
/dash/api-keys                  → API Keys
/dash/users                     → Users (if permitted)
/dash/analytics                 → Analytics
/dash/billing                   → Billing & Credits
/dash/settings                  → Settings
```

---

## Design Requirements

### Theme: Minimal Black & White

```css
:root {
  --background: #FFFFFF;
  --foreground: #000000;
  --border: #E5E5E5;
  --muted: #F5F5F5;
  --muted-foreground: #6B7280;

  /* Status colors (only exceptions) */
  --success: #22C55E;
  --error: #EF4444;
  --warning: #F59E0B;
  --info: #6B7280;
}
```

### UX Principles
1. **Tree structure for wizards** - Not everything horizontal
2. **Clear navigation** - User knows where they are
3. **Progressive disclosure** - Show relevant options based on selections
4. **Consistent patterns** - Tables, modals, forms all follow same patterns

---

## Stub Data Examples

### Contracts
```typescript
export const stubContracts: Contract[] = [
  {
    id: "sess-001",
    sessionId: "FS-2026-00001",
    status: "SIGNED",
    documentName: "Employment_Contract.pdf",
    documentHash: "sha256:abc123...",
    pageCount: 5,
    fileSizeKb: 245,
    signerName: "Ahmed Al Maktoum",
    signerIdNumber: "784-1990-1234567-1",
    signerIdType: "EMIRATES_ID",
    lastStep: "COMPLETED",
    createdAt: new Date("2026-01-15T10:00:00Z"),
    completedAt: new Date("2026-01-15T14:32:00Z"),
    orgId: "org-001",
    orgName: "Dubai Health Authority"
  },
  {
    id: "sess-002",
    sessionId: "FS-2026-00002",
    status: "ABANDONED",
    documentName: "NDA_Agreement.pdf",
    lastStep: "KYC_STARTED",  // User dropped off during KYC
    // ...
  },
  // More examples...
];
```

### Organizations
```typescript
export const stubOrganizations: Organization[] = [
  {
    id: "org-001",
    name: "Dubai Health Authority",
    type: "GOVERNMENT",
    status: "ACTIVE",
    enabledModules: ["KYC", "FACE_SIGN"],
    totalContracts: 1247,
    activeUsers: 23
  },
  {
    id: "org-002",
    name: "Tabby",
    type: "PRIVATE",
    status: "ACTIVE",
    enabledModules: ["KYC", "FACE_SIGN"],
    totalContracts: 3421,
    activeUsers: 15
  },
  // More...
];
```

---

## Key Metrics for Analytics

1. **Completion Rate**: signed / total
2. **Drop-off Analysis**: At which step users abandon
3. **Daily/Weekly/Monthly trends**
4. **Status distribution**

---

## Tech Stack

| Technology | Purpose |
|------------|---------|
| React 18+ | UI framework |
| TypeScript | Type safety |
| Vite | Build tool |
| shadcn/ui | Component library |
| Tailwind CSS | Styling |
| React Router v6 | Routing |
| Lucide React | Icons |
| date-fns | Date formatting |
| Recharts | Charts |
| @tanstack/react-table | Data tables |
| react-pdf | PDF preview |

---

## Deliverables

1. **Skeleton dashboard** with all pages
2. **Stub data** demonstrating all features
3. **Black & white minimal UI**
4. **Good UX** (tree-structured wizards, clear navigation)
5. **Two personas** working (Console & Dash)
6. **Drop-off analytics** showing where users abandon

---

## Next Steps

1. Set up Vite + React + TypeScript project
2. Add shadcn/ui with black/white theme
3. Create stub data files
4. Build layout (sidebar, header, dashboard switcher)
5. Build Contracts module first (main focus)
6. Add Analytics with drop-off visualization
7. Build remaining modules
8. Deploy to Vercel, share link

---

## Quick Start Commands

```bash
# Create project
npm create vite@latest face-sign-dashboard -- --template react-ts
cd face-sign-dashboard

# Install dependencies
npm install
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p

# Add shadcn/ui
npx shadcn@latest init
npx shadcn@latest add button card table input select badge dialog dropdown-menu avatar separator tabs toast sheet progress

# Additional packages
npm install react-router-dom lucide-react date-fns recharts @tanstack/react-table react-pdf

# Run
npm run dev
```
